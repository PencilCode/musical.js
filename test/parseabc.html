<script src="lib/qunit.js"></script>
<script src="lib/fake_timers.js"></script>
<script src="../musical.js"></script>
<link href="lib/qunit.css" rel="stylesheet">
<body>
<div id="qunit"></div>
<script>
module("Test of the parseABCFile function.");

asyncTest("Parses two octaves", function() {
  var result = parseABCFile(
    "C ^C D ^D E F ^F G ^G A ^A B c ^c d ^d e f ^f g ^g a ^a b"
  );
  deepEqual(result,
    {
      "voice": {
        "": {
          "id": "",
          "stems": [
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 261.6255653005986,
                  "pitch": "C",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 277.1826309768721,
                  "pitch": "^C",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 293.6647679174076,
                  "pitch": "D",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 311.12698372208087,
                  "pitch": "^D",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 329.6275569128699,
                  "pitch": "E",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 349.2282314330039,
                  "pitch": "F",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 369.9944227116344,
                  "pitch": "^F",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 391.99543598174927,
                  "pitch": "G",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 415.3046975799451,
                  "pitch": "^G",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 440,
                  "pitch": "A",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 466.1637615180899,
                  "pitch": "^A",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 493.8833012561241,
                  "pitch": "B",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },

            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 523.2511306011972,
                  "pitch": "c",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 554.3652619537442,
                  "pitch": "^c",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 587.3295358348151,
                  "pitch": "d",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 622.2539674441618,
                  "pitch": "^d",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 659.2551138257398,
                  "pitch": "e",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 698.4564628660078,
                  "pitch": "f",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 739.9888454232688,
                  "pitch": "^f",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 783.9908719634985,
                  "pitch": "g",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 830.6093951598903,
                  "pitch": "^g",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 880,
                  "pitch": "a",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 932.3275230361799,
                  "pitch": "^a",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            },
            {
              "duration": "",
              "notes": [
                {
                  "duration": "",
                  "frequency": 987.7666025122483,
                  "pitch": "b",
                  "tie": false,
                  "time": 1
                }
              ],
              "staccato": false,
              "time": 1
            }
          ]
        }
      }
    }
  );
  start();
});
asyncTest("Parses New York State of Mind.", function() {
  var result = parseABCFile(
    "X: 1\n" +
    "T: New York State of Mind (By: Sambuka of Firefoot)\n" +
    "Z: Billy Joel\n" +
    "L: 1/4\n" +
    "Q: 120\n" +
    "K: C\n" +
    "\n" +
    "[F/4c3/8G/4F,17/8] z/4 [c/4F/4^G/4] z/4 [^G/4c/4F/4] z3/4\n" +
    "[^D/4^G/4c3/8F/4] z3/4 [F5/4=D9/8^G5/4^A,33/8] z11/8 [c9/8z/2]\n"
  );
  deepEqual(result,
    {
      X: "1",
      T: "New York State of Mind (By: Sambuka of Firefoot)",
      Z: "Billy Joel",
      unitnote: 0.25,
      L: "1/4",
      tempo: 120,
      Q: "120",
      K: "C",
      voice: {
        "": {
          id: "",
          stems: [
            {
              notes: [
                {
                  pitch: "F",
                  tie: false,
                  frequency: 349.2282314330039,
                  duration: "/4",
                  time: 0.25
                }, {
                  pitch: "c",
                  tie: false,
                  frequency: 523.2511306011972,
                  duration: "3/8",
                  time: 0.375
                }, {
                  pitch: "G",
                  tie: false,
                  frequency: 391.99543598174927,
                  duration: "/4",
                  time: 0.25
                }, {
                  pitch: "F,",
                  tie: false,
                  frequency: 174.61411571650194,
                  duration: "17/8",
                  time: 1.875
                }
              ],
              duration: "/4",
              staccato: false,
              time: 0.25
            }, {
              notes: [],
              duration: "/4",
              staccato: false,
              time: 0.25
            }, {
              notes: [
                {
                  pitch: "c",
                  tie: false,
                  frequency: 523.2511306011972,
                  duration: "/4",
                  time: 0.25
                }, {
                  pitch: "F",
                  tie: false,
                  frequency: 349.2282314330039,
                  duration: "/4",
                  time: 0.25
                }, {
                  pitch: "^G",
                  tie: false,
                  frequency: 415.3046975799451,
                  duration: "/4",
                  time: 0.25
                }
              ],
              duration: "/4",
              staccato: false,
              time: 0.25
            }, {
              notes: [],
              duration: "/4",
              staccato: false,
              time: 0.25
            }, {
              notes: [
                {
                  pitch: "^G",
                  tie: false,
                  frequency: 415.3046975799451,
                  duration: "/4",
                  time: 0.25
                }, {
                  pitch: "c",
                  tie: false,
                  frequency: 523.2511306011972,
                  duration: "/4",
                  time: 0.25
                }, {
                  pitch: "F",
                  tie: false,
                  frequency: 349.2282314330039,
                  duration: "/4",
                  time: 0.25
                }
              ],
              duration: "/4",
              staccato: false,
              time: 0.25
            }, {
              notes: [],
              duration: "3/4",
              staccato: false,
              time: 0.75
            }, {
              notes: [
                {
                  pitch: "^D",
                  tie: false,
                  frequency: 311.12698372208087,
                  duration: "/4",
                  time: 0.25
                }, {
                  pitch: "^G",
                  tie: false,
                  frequency: 415.3046975799451,
                  duration: "/4",
                  time: 0.25
                }, {
                  pitch: "c",
                  tie: false,
                  frequency: 523.2511306011972,
                  duration: "3/8",
                  time: 0.375
                }, {
                  pitch: "F",
                  tie: false,
                  frequency: 349.2282314330039,
                  duration: "/4",
                  time: 0.25
                }
              ],
              duration: "/4",
              staccato: false,
              time: 0.25
            }, {
              notes: [],
              duration: "3/4",
              staccato: false,
              time: 0.75
            },
            {
              notes: [
                {
                  pitch: "F",
                  tie: false,
                  frequency: 349.2282314330039,
                  duration: "5/4",
                  time: 1.25
                }, {
                  pitch: "D",
                  tie: false,
                  frequency: 293.6647679174076,
                  duration: "9/8",
                  time: 1.125
                }, {
                  pitch: "^G",
                  tie: false,
                  frequency: 415.3046975799451,
                  duration: "5/4",
                  time: 1.25
                }, {
                  pitch: "^A,",
                  tie: false,
                  frequency: 233.08188075904496,
                  duration: "33/8",
                  time: 3.375
                }
              ],
              duration: "9/8",
              staccato: false,
              time: 1.125
            }, {
              notes: [],
              duration: "11/8",
              staccato: false,
              time: 1.125
            }, {
              notes: [
                {
                  pitch: "c",
                  tie: false,
                  frequency: 523.2511306011972,
                  duration: "9/8",
                  time: 1.125
                }
              ],
              duration: "/2",
              staccato: false,
              time: 0.5
            }
          ]
        }
      }
    }
  );
  start();
});

</script>

